Version 4
SHEET 1 4228 2080
WIRE -880 -240 -1120 -240
WIRE -800 -240 -880 -240
WIRE -704 -240 -800 -240
WIRE 48 -240 -304 -240
WIRE 624 -240 480 -240
WIRE 784 -240 688 -240
WIRE 944 -240 784 -240
WIRE 480 -224 480 -240
WIRE -1120 -208 -1120 -240
WIRE -880 -208 -880 -240
WIRE -800 -208 -800 -240
WIRE 784 -208 784 -240
WIRE 48 -192 48 -240
WIRE 944 -176 944 -240
WIRE 480 -112 480 -144
WIRE 784 -112 784 -128
WIRE 784 -112 736 -112
WIRE -1120 -96 -1120 -144
WIRE -1040 -96 -1120 -96
WIRE -880 -96 -880 -144
WIRE -880 -96 -960 -96
WIRE -800 -96 -800 -128
WIRE -800 -96 -832 -96
WIRE -800 -80 -800 -96
WIRE 48 -80 48 -112
WIRE -1120 -48 -1120 -96
WIRE -880 -48 -880 -96
WIRE -304 -48 -304 -80
WIRE 480 -16 480 -32
WIRE 784 -16 784 -48
WIRE 784 -16 480 -16
WIRE 944 -16 944 -96
WIRE 944 -16 784 -16
WIRE 48 32 48 0
WIRE -1120 48 -1120 16
WIRE -880 48 -880 16
WIRE -880 48 -1120 48
WIRE -800 48 -800 -16
WIRE -800 48 -880 48
WIRE 624 64 480 64
WIRE 784 64 688 64
WIRE 944 64 784 64
WIRE 1072 64 944 64
WIRE 480 80 480 64
WIRE 784 80 784 64
WIRE 944 96 944 64
WIRE 1072 128 1072 64
WIRE 48 144 48 112
WIRE 160 144 48 144
WIRE 208 144 160 144
WIRE 320 144 272 144
WIRE 48 176 48 144
WIRE 784 176 784 160
WIRE 784 176 736 176
WIRE 944 176 944 160
WIRE 480 192 480 160
WIRE 160 240 160 144
WIRE 208 240 160 240
WIRE 320 240 320 144
WIRE 320 240 288 240
WIRE -240 256 -240 160
WIRE -128 256 -240 256
WIRE -16 256 -48 256
WIRE 0 256 -16 256
WIRE -416 272 -416 256
WIRE 320 272 320 240
WIRE 480 288 480 272
WIRE 784 288 784 240
WIRE 784 288 480 288
WIRE 944 288 944 256
WIRE 944 288 784 288
WIRE 1072 288 1072 208
WIRE 1072 288 944 288
WIRE -416 368 -416 352
WIRE 48 368 48 272
WIRE 48 368 -416 368
WIRE 320 368 320 336
WIRE 320 368 48 368
WIRE 48 416 48 368
WIRE 192 816 128 816
WIRE 336 816 272 816
WIRE 528 816 336 816
WIRE 864 848 864 816
WIRE 336 896 336 816
WIRE 864 960 864 928
WIRE 1024 960 864 960
WIRE 864 992 864 960
WIRE 336 1040 336 976
WIRE 864 1104 864 1072
WIRE 240 1200 240 1168
WIRE 0 1328 -64 1328
WIRE 240 1328 240 1280
WIRE 240 1328 80 1328
WIRE 304 1328 240 1328
WIRE 928 1328 720 1328
WIRE 304 1392 -48 1392
WIRE 1008 1392 720 1392
WIRE 1088 1392 1008 1392
WIRE 1296 1392 1088 1392
WIRE 1296 1408 1296 1392
WIRE 1088 1424 1088 1392
WIRE 800 1456 720 1456
WIRE 304 1520 240 1520
WIRE 1008 1520 1008 1392
WIRE 1008 1520 720 1520
WIRE 1296 1520 1296 1488
WIRE 1088 1536 1088 1488
WIRE 240 1584 16 1584
WIRE 304 1584 240 1584
WIRE 816 1584 720 1584
WIRE 304 1648 112 1648
WIRE 768 1648 720 1648
WIRE 16 1664 16 1584
WIRE 112 1696 112 1648
WIRE 240 1712 240 1584
WIRE 304 1712 240 1712
WIRE 816 1712 720 1712
WIRE 304 1776 240 1776
WIRE 896 1776 720 1776
WIRE 240 1808 240 1776
WIRE 16 1824 16 1728
WIRE 112 1824 112 1776
WIRE 240 1904 240 1872
FLAG 48 416 0
FLAG 944 -240 Vout2
FLAG 944 64 Vout3
FLAG 944 -16 0
FLAG 944 288 0
FLAG 480 -240 Vsec+
FLAG 48 144 Vds
FLAG 48 -240 Vprim+
FLAG -16 256 Vg
FLAG 816 1584 0
FLAG 816 1712 0
FLAG 240 1904 0
FLAG 112 1824 0
FLAG 16 1824 0
FLAG 896 1776 PWM_in
FLAG 240 1520 Vosc
FLAG 336 1040 0
FLAG 528 816 Vo_comp
FLAG 864 1104 0
FLAG 1024 960 Vref_comp
FLAG 928 1328 Vref
FLAG 864 816 Vref
FLAG 800 1456 Vcontrol
FLAG -48 1392 Vref_comp
FLAG -64 1328 Vo_comp
FLAG 1088 1536 0
FLAG 1296 1520 0
FLAG -240 160 Vcontrol
FLAG 240 1168 PWM_in
FLAG 128 816 Vout3
FLAG -304 -48 0
FLAG -304 -240 Vd
FLAG -800 48 0
FLAG -704 -240 Vd
DATAFLAG 128 1328 "round($*10000)/10000"
DATAFLAG 128 1392 "round($*10000)/10000"
DATAFLAG 432 816 "round(V(vo_comp)*10000)/10000"
DATAFLAG 832 1328 "round($*100)/100"
DATAFLAG 1088 1392 ""
DATAFLAG 944 960 "round($*10000)/10000"
DATAFLAG 816 1776 "round($*10000)/10000"
DATAFLAG 832 -240 "round($*100)/100"
DATAFLAG 832 64 "round($*100)/100"
SYMBOL nmos 0 176 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL diode 624 -224 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value MUR460
SYMBOL res -32 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rg
SYMATTR Value 56
SYMBOL cap 768 -112 R0
WINDOW 0 32 3 Left 2
SYMATTR InstName C2
SYMATTR Value 47µ
SYMBOL res 928 -192 R0
SYMATTR InstName R2
SYMATTR Value 56
SYMBOL ind2 32 -96 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L1
SYMATTR Value 8.53m
SYMATTR Type ind
SYMBOL ind2 496 -240 M0
SYMATTR InstName L2
SYMATTR Value 468µ
SYMATTR Type ind
SYMBOL diode 624 80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value MUR460
SYMBOL cap 768 176 R0
WINDOW 0 32 3 Left 2
SYMATTR InstName C3
SYMATTR Value 47µ
SYMBOL ind2 496 64 M0
SYMATTR InstName L3
SYMATTR Value 275µ
SYMATTR Type ind
SYMBOL cap 224 1808 R0
SYMATTR InstName Css
SYMATTR Value 5µ
SYMBOL cap 0 1664 R0
SYMATTR InstName CT
SYMATTR Value 3.3n
SYMBOL SG3525A 448 1424 R0
SYMATTR InstName U2
SYMATTR Value SG3525A
SYMBOL res 288 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rbo
SYMATTR Value 33k
SYMBOL res 352 992 R180
WINDOW 0 36 76 Left 2
WINDOW 3 34 44 Left 2
SYMATTR InstName Rao
SYMATTR Value 5.6k
SYMBOL res 880 944 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3bref
SYMATTR Value 12k
SYMBOL res 880 1088 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Raref
SYMATTR Value 10k
SYMBOL res 96 1680 R0
SYMATTR InstName RT
SYMATTR Value 2.7k
SYMBOL cap 1072 1424 R0
SYMATTR InstName Cd
SYMATTR Value 100n
SYMBOL voltage 1296 1392 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vgg
SYMATTR Value 16
SYMBOL res 96 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 470
SYMBOL res 256 1296 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Rf
SYMATTR Value 47k
SYMBOL voltage -416 256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 16 0 0.1n 0.1n 4.35u 13.3u)
SYMBOL res 32 -96 R0
SYMATTR InstName rL1
SYMATTR Value 1.2
SYMBOL ind 32 16 R0
SYMATTR InstName Ld
SYMATTR Value 0.853m
SYMBOL res 768 64 R0
SYMATTR InstName ESR3
SYMATTR Value 1
SYMBOL res 768 -224 R0
SYMATTR InstName ESR2
SYMATTR Value 1
SYMBOL res 928 160 R0
SYMATTR InstName Rled3
SYMATTR Value 800
SYMBOL voltage -304 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vd
SYMATTR Value 280
SYMBOL res 464 -128 R0
SYMATTR InstName rL2
SYMATTR Value 0.2
SYMBOL res 464 176 R0
SYMATTR InstName rL3
SYMATTR Value 0.2
SYMBOL voltage -1056 -96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vin
SYMATTR Value SINE(0 311 50)
SYMBOL diode -1104 -144 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value MUR460
SYMBOL diode -864 -144 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value MUR460
SYMBOL diode -1104 16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value MUR460
SYMBOL diode -864 16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMATTR Value MUR460
SYMBOL cap -816 -80 R0
SYMATTR InstName C1
SYMATTR Value 220µ
SYMBOL LED 928 96 R0
SYMATTR InstName LED3
SYMBOL cap 304 272 R0
SYMATTR InstName C4
SYMATTR Value 4.7n
SYMBOL diode 208 160 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName Dsn
SYMATTR Value MUR460
SYMBOL res 304 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rsn
SYMATTR Value 47
SYMBOL res 1056 112 R0
SYMATTR InstName R3
SYMATTR Value 47
SYMBOL res -816 -224 R0
SYMATTR InstName ESR1
SYMATTR Value 1
TEXT -192 488 Left 2 ;Vo/Vd = (N2/N1) * D/(1-D) = (L2/L1)^(1/2) * D/(1-D)
TEXT 88 -216 Left 2 !K1 L1 L2 L3 1
TEXT 104 -296 Left 2 ;Flyback
TEXT 1344 -312 Left 2 ;Directivas Spice
TEXT 1392 -120 Left 2 !.inc opamp.sub
TEXT -408 1664 Left 2 ;fsw= 2/(CT*(RT*0.7))
TEXT -408 1720 Left 2 ;Con CT=3.3nF y RT = 2.8kOhm\n=> fsw = 75KHz
TEXT 912 1640 Left 2 !.inc SG3525A.sub
TEXT -408 1600 Left 2 ;Frecuencia
TEXT 64 728 Left 2 ;Divisor Vo
TEXT 800 728 Left 2 ;Divisor Vref
TEXT 1416 1360 Left 2 ;Ponemos una fuente constante solo para simular,porque el modelo spice no contempla la carga inicial de un capacitor entre los 300V y esta parte
TEXT 1392 -264 Left 2 !.param Fs = 75k
TEXT 1392 -232 Left 2 !.param Ts = 1/Fs
TEXT 1392 -200 Left 2 !.param Ton = Ts* D
TEXT 1392 -168 Left 2 !.param D=0.3
TEXT 1392 -88 Left 2 !.tran 0 20m 0 100u
TEXT 1288 1800 Left 2 ;Compensacion de Polos y Ceros
TEXT 1288 1832 Left 2 ;Ts aproximadamente  1/(C5*30) *10^-6
TEXT -992 -296 Left 2 ;Rectificador
LINE Normal 1616 1760 1328 1760 2
LINE Normal 1664 1600 1664 1760 2
LINE Normal 1376 1600 1664 1600 2
LINE Normal 1328 1600 1376 1600 2
LINE Normal 1664 1760 1616 1760 2
LINE Normal 1296 1600 1328 1600 2
LINE Normal 1296 1760 1296 1600 2
LINE Normal 1328 1760 1296 1760 2
RECTANGLE Normal 1264 576 -512 -352 2
RECTANGLE Normal 1888 -48 1312 -352 2
RECTANGLE Normal 208 1872 -448 1552 2
RECTANGLE Normal -1264 112 -624 -352 2
