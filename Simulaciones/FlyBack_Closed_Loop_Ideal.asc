Version 4
SHEET 1 4228 2080
WIRE 48 -240 -400 -240
WIRE 416 -176 272 -176
WIRE 560 -176 480 -176
WIRE 624 -176 560 -176
WIRE 672 -176 624 -176
WIRE 48 -160 48 -240
WIRE 560 -112 560 -176
WIRE 624 -112 624 -176
WIRE 672 -112 672 -176
WIRE 272 -96 272 -176
WIRE -400 0 -400 -240
WIRE 272 48 272 -16
WIRE 544 48 272 48
WIRE 560 48 560 -48
WIRE 560 48 544 48
WIRE 624 48 624 -48
WIRE 624 48 560 48
WIRE 672 48 672 -32
WIRE 672 48 624 48
WIRE 416 128 272 128
WIRE 560 128 480 128
WIRE 592 128 560 128
WIRE 624 128 592 128
WIRE 672 128 624 128
WIRE 48 144 48 -80
WIRE 48 176 48 144
WIRE 560 192 560 128
WIRE 624 192 624 128
WIRE 672 192 672 128
WIRE 272 208 272 128
WIRE -176 256 -176 128
WIRE -128 256 -176 256
WIRE -16 256 -48 256
WIRE 0 256 -16 256
WIRE -256 272 -256 256
WIRE 272 352 272 288
WIRE 528 352 272 352
WIRE 560 352 560 256
WIRE 560 352 528 352
WIRE 624 352 624 256
WIRE 624 352 560 352
WIRE 672 352 672 272
WIRE 672 352 624 352
WIRE -400 368 -400 80
WIRE -256 368 -256 352
WIRE -256 368 -400 368
WIRE 48 368 48 272
WIRE 48 368 -256 368
WIRE -400 432 -400 368
WIRE 192 816 128 816
WIRE 336 816 272 816
WIRE 528 816 336 816
WIRE 864 848 864 816
WIRE 336 896 336 816
WIRE 864 960 864 928
WIRE 1024 960 864 960
WIRE 864 992 864 960
WIRE 336 1040 336 976
WIRE 864 1104 864 1072
WIRE 304 1328 -64 1328
WIRE 928 1328 720 1328
WIRE 304 1392 -48 1392
WIRE 1008 1392 720 1392
WIRE 1088 1392 1008 1392
WIRE 1296 1392 1088 1392
WIRE 1296 1408 1296 1392
WIRE 1088 1424 1088 1392
WIRE 800 1456 720 1456
WIRE 1296 1504 1296 1488
WIRE 304 1520 240 1520
WIRE 1008 1520 1008 1392
WIRE 1008 1520 720 1520
WIRE 1088 1520 1088 1488
WIRE 240 1584 16 1584
WIRE 304 1584 240 1584
WIRE 816 1584 720 1584
WIRE 304 1648 128 1648
WIRE 768 1648 720 1648
WIRE 16 1664 16 1584
WIRE 1440 1664 1344 1664
WIRE 1600 1664 1504 1664
WIRE 128 1696 128 1648
WIRE 240 1712 240 1584
WIRE 304 1712 240 1712
WIRE 816 1712 720 1712
WIRE 1344 1728 1344 1664
WIRE 1392 1728 1344 1728
WIRE 1472 1728 1456 1728
WIRE 1600 1728 1600 1664
WIRE 1600 1728 1552 1728
WIRE 304 1776 240 1776
WIRE 896 1776 720 1776
WIRE 240 1808 240 1776
WIRE 16 1824 16 1728
WIRE 128 1824 128 1776
WIRE 240 1904 240 1872
FLAG -400 432 0
FLAG 672 -176 Vout1
FLAG 672 128 Vout2
FLAG 544 48 0
FLAG 528 352 0
FLAG 272 -176 Vsec+
FLAG 48 144 Vds
FLAG 48 -240 Vprim+
FLAG -16 256 Vg
FLAG 816 1584 0
FLAG 816 1712 0
FLAG 240 1904 0
FLAG 128 1824 0
FLAG 16 1824 0
FLAG 896 1776 PWM_in
FLAG 240 1520 Vosc
FLAG 336 1040 0
FLAG 528 816 Vo_comp
FLAG 864 1104 0
FLAG 1024 960 Vref_comp
FLAG 928 1328 Vref
FLAG 864 816 Vref
FLAG 800 1456 Vcontrol
FLAG -48 1392 Vref_comp
FLAG -64 1328 Vo_comp
FLAG 1088 1520 0
FLAG 128 816 Vmed
FLAG 1296 1504 0
FLAG 592 128 Vmed
FLAG -176 128 Vcontrol
FLAG 1600 1664 Vo_comp
FLAG 1344 1664 PWM_in
DATAFLAG 128 1328 "round($*10000)/10000"
DATAFLAG 128 1392 "round($*10000)/10000"
DATAFLAG 432 816 "round(V(vo_comp)*10000)/10000"
DATAFLAG 832 1328 "round($*100)/100"
DATAFLAG 1088 1392 ""
DATAFLAG 944 960 "round($*10000)/10000"
DATAFLAG 816 1776 "round($*10000)/10000"
SYMBOL nmos 0 176 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL diode 416 -160 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value MUR460
SYMBOL voltage -400 -16 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 280
SYMBOL res -32 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 56
SYMBOL cap 544 -112 R0
WINDOW 0 32 3 Left 2
SYMATTR InstName C1
SYMATTR Value 47µ
SYMBOL res 656 -128 R0
SYMATTR InstName R1
SYMATTR Value 50
SYMBOL ind2 32 -64 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L1
SYMATTR Value 19.989m
SYMATTR Type ind
SYMBOL ind2 288 -112 M0
SYMATTR InstName L2
SYMATTR Value 867.569µ
SYMATTR Type ind
SYMBOL diode 416 144 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value MUR460
SYMBOL cap 544 192 R0
WINDOW 0 32 3 Left 2
SYMATTR InstName C2
SYMATTR Value 47µ
SYMBOL res 656 176 R0
SYMATTR InstName R2
SYMATTR Value 50
SYMBOL ind2 288 192 M0
SYMATTR InstName L3
SYMATTR Value 401.164µ
SYMATTR Type ind
SYMBOL cap 608 192 R0
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL cap 608 -112 R0
SYMATTR InstName C6
SYMATTR Value 1µ
SYMBOL cap 224 1808 R0
SYMATTR InstName Css1
SYMATTR Value 5µ
SYMBOL cap 0 1664 R0
SYMATTR InstName CT1
SYMATTR Value 3.3n
SYMBOL SG3525A 448 1424 R0
SYMATTR InstName U2
SYMATTR Value SG3525A
SYMBOL res 288 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rb1
SYMATTR Value 33k
SYMBOL res 352 992 R180
WINDOW 0 36 76 Left 2
WINDOW 3 34 44 Left 2
SYMATTR InstName Ra1
SYMATTR Value 5.6k
SYMBOL res 880 944 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 12k
SYMBOL res 880 1088 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 112 1680 R0
SYMATTR InstName RT1
SYMATTR Value 2.7k
SYMBOL cap 1072 1424 R0
SYMATTR InstName Cd1
SYMATTR Value 100n
SYMBOL voltage 1296 1392 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 16
SYMBOL voltage -256 256 R0
WINDOW 3 -11 192 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 16 0 1n 1n {Ton} {Ts} 1000000000)
SYMATTR InstName V3
SYMBOL cap 1456 1712 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cc1
SYMATTR Value 10n
SYMBOL res 1568 1712 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL cap 1504 1648 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 -49 28 VTop 2
SYMATTR InstName Cc2
SYMATTR Value 1µ
TEXT -192 488 Left 2 ;Vo/Vd = (N2/N1) * D/(1-D) = (L2/L1)^(1/2) * D/(1-D)
TEXT 96 -176 Left 2 !K1 L1 L2 L3 1
TEXT 104 -296 Left 2 ;Flyback
TEXT 1040 -376 Left 2 ;Directivas Spice
TEXT 1080 8 Left 2 !.inc opamp.sub
TEXT -408 1664 Left 2 ;fsw= 2/(CT*(RT*0.7))
TEXT -408 1720 Left 2 ;Con CT=3.3nF y RT = 2.8kOhm\n=> fsw = 75KHz
TEXT 912 1640 Left 2 !.inc SG3525A.sub
TEXT -408 1600 Left 2 ;Frecuencia
TEXT 64 728 Left 2 ;Divisor Vo
TEXT 800 728 Left 2 ;Divisor Vref
TEXT 1416 1360 Left 2 ;Ponemos una fuente constante solo para simular,porque el modelo spice no contempla la carga inicial de un capacitor entre los 300V y esta parte
TEXT 1088 -328 Left 2 !.param Fs = 75k
TEXT 1088 -296 Left 2 !.param Ts = 1/Fs
TEXT 1088 -264 Left 2 !.param Ton = Ts* D
TEXT 1088 -216 Left 2 !.param D=0.3
TEXT -592 1928 Left 2 !.tran 0 27m 25m 1u
TEXT 1288 1800 Left 2 ;Compensacion de Polos y Ceros
TEXT 1288 1832 Left 2 ;Ts aproximadamente  1/(C5*30) *10^-6
LINE Normal 1616 1760 1312 1760 2
LINE Normal 1664 1600 1664 1760 2
LINE Normal 1360 1600 1664 1600 2
LINE Normal 1312 1600 1360 1600 2
LINE Normal 1664 1760 1616 1760 2
LINE Normal 1280 1600 1312 1600 2
LINE Normal 1280 1760 1280 1600 2
LINE Normal 1312 1760 1280 1760 2
RECTANGLE Normal 880 576 -592 -336 2
RECTANGLE Normal 1584 -112 1008 -416 2
RECTANGLE Normal 208 1872 -448 1552 2
